#!/usr/bin/env bash

# Path Definitions
WALL_DIR="/home/$USER/Pictures/Wallpapers"
ROFI_LAYOUT="$HOME/.config/rofi/wallpaper.rasi"

# 1. Function to list walls + include a Random option
list_walls() {
    # Add the "Random" option at the very top
    echo -en "  Random Wallpaper\0icon\x1ffolder\n"
    
    # Find images (added webp and gif support)
    find "$WALL_DIR" -maxdepth 1 -type f \( -iname "*.jpg" -o -iname "*.png" -o -iname "*.jpeg" -o -iname "*.webp" -o -iname "*.gif" \) | while read -r line; do
        # Format: Name to display\0icon\x1fFull/Path/To/Image
        echo -en "$(basename "$line")\0icon\x1f$line\n"
    done
}

# 2. Launch Rofi
selected=$(list_walls | rofi -dmenu -i -p "󰸉" -config "$ROFI_LAYOUT")

# 3. Apply the choice
if [ -n "$selected" ]; then
    if [[ "$selected" == "  Random Wallpaper" ]]; then
        # Pick a random file from the directory
        random_wall=$(find "$WALL_DIR" -type f \( -iname "*.jpg" -o -iname "*.png" -o -iname "*.jpeg" -o -iname "*.webp" \) | shuf -n 1)
        swww img "$random_wall" --transition-type wave
        notify-send "Wallpaper" "Randomly selected: $(basename "$random_wall")"
    else
        # Apply the specific selected wallpaper
        swww img "$WALL_DIR/$selected" --transition-type center
        notify-send "Wallpaper" "Applied: $selected"
    fi
fi